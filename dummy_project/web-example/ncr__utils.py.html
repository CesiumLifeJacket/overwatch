<!doctype html>
<html>
<head>
	<link rel="stylesheet" href="css/styles/arduino-light.css">
	<link rel="stylesheet" href="css/file.css">
	<script src="js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<h1><a href=Index.html>/</a><a href=ncr.html>ncr/</a>utils.py</h1>

<pre><code class="python">
'''A few miscellaneous functions and objects used by the datastream and datastr<div class="violation" type="E501" title="line too long (95 &gt; 79 characters)" style="width:1ch;"></div>eamdiff modules.
'''
import re
import sys
import time
import json
import numpy as np
import datetime as dt

# regex for checking netcdf file names
ncfname_re = \
    re.compile('^([a-z]{3})([a-z0-9]*)([A-Z]\d+)\.([a-z]\d).'
   <div class="violation" type="W503" title="line break before binary operator" style="width:1ch;"></div> <div class="violation" type="E225" title="missing whitespace around operator" style="width:1ch;"></div>           +'(\d{4})(\d\d)(\d\d)\.(\d\d)(\d\d)(\d\d)\<div class="violation" type="E302" title="expected 2 blank lines, found 1" style="width:1ch;"></div>.(cdf|nc)$')

def file_time(fname):
    '''Return time in netcdf file name as a datetime object
    '''
    match = ncfname_re.match(fname)
    return dt.datetime(*map(int, match.groups()[4:10])) <div class="violation" type="E302" title="expected 2 blank lines, found 1" style="width:1ch;"></div>if match else None

def file_datastream(fname):
    '''return the datstream substring from a filename'''
    match = ncfname_re.match(fname)
    return ''.j<div class="violation" type="E302" title="expected 2 blank lines, found 1" style="width:1ch;"></div>oin(match.groups()[:4])

def store_difference(func):
    '''Decorator that causes difference() methods to store and reuse their result.
    '''
    def difference(self):
        if not hasattr(self, '_difference'):
            setattr(self, '_difference', func(self))
        return self._<div class="violation" type="E302" title="expected 2 blank lines, found 1" style="width:1ch;"></div>difference
    return difference

def json_section(self, contents):
    '''Returns a json section object with the specified contents.
    '''
    sec = {
        'type': 'section',
        'name': self.name,
        'contents': contents
    }
    if hasattr(self, 'difference'):
            sec['difference'] = self.difference()
    elif hasattr(self, '_difference'):
        sec['<div class="violation" type="E302" title="expected 2 blank lines, found 1" style="width:1ch;"></div>difference'] = self._difference
    return sec

def JEncoder(obj):
    ''' Defines a few default <div class="violation" type="E501" title="line too long (82 &gt; 79 characters)" style="width:1ch;"></div>behaviours when the json encoder doesn't know what to do
    '''
    try:
        if np.isnan(obj):
            return None
        elif obj // 1 == obj:
            return int(obj)
        else:
            return float(obj)
    except:
        try:
            return str(obj)
        except:
            raise<div class="violation" type="E501" title="line too long (93 &gt; 79 characters)" style="width:1ch;"></div> TypeError('O<div class="violation" type="E502" title="the backslash is redundant between brackets" style="width:1ch;"></div>bject of type {0}<div class="violation" type="E128" title="continuation line under-indented for visual indent" style="width:1ch;"></div> with value of {1} is not JSON<div class="violation" type="E302" title="expected 2 blank lines, found 1" style="width:1ch;"></div> serializable' \
                .format(type(obj), repr(obj)))

def shared_times(old_ftimes, new_ftimes):
    '''Yeilds time intervals shared by both the old and new files, in order.

    Parameters:
        old_ftimes  list of old file times as TimeInterval objects
        new_fties   list of new file times as TimeInterval objects

    Yeilds:
        yeilds the tuple:
            beg    beginning of the shared time interval
            end    end of the shared time interval
   <div class="violation" type="E501" title="line too long (85 &gt; 79 characters)" style="width:1ch;"></div>         old_i  index of interval in old_ftimes that overlaps this shared interval
  <div class="violation" type="E501" title="line too long (85 &gt; 79 characters)" style="width:1ch;"></div>          new_i  index of interval in new_ftimes that overlaps this shared interval
    '''
    old_itr = iter(enumerate(old_ftimes))
    new_itr = iter(enumerate(new_ftimes))

    old_i, old_f = next(old_itr, (None, None))
    new_i, new_f = next(new_itr, (None, None))

    while old_f and new_f:
        beg = max(old_f.beg, new_f.beg)
        end = min(old_f.end, new_f.end)

        if beg &lt; end:
            yield beg, end, old_i, new_i

        if old_f.end &lt; new_f.end:
            old_i, old_f = next(old_itr, (None, None))
        elif old_f.end &gt; new_f.end:
            new_i, new_f = next(new_itr, (None, None))
        else:
            old_i, old_f = next(old_itr, (None, None))
            new_i, new_f = next(new_itr, (None, None))

</code></pre>
</body>
</html>